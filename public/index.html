<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>iPhone 4 Clock</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: Arial, sans-serif;
            height: 100vh;
            overflow: hidden;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        
        .clock-container {
            display: -webkit-box;
            display: -moz-box;
            display: box;
            -webkit-box-align: center;
            -moz-box-align: center;
            box-align: center;
            -webkit-box-pack: center;
            -moz-box-pack: center;
            box-pack: center;
            height: 100vh;
            width: 100vw;
        }
        
        .clock {
            font-size: 72px;
            font-weight: bold;
            text-align: center;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .time-separator {
            color: #ffffff;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        /* iPhone 4 화면 크기 최적화 */
        @media screen and (max-width: 480px) {
            .clock {
                font-size: 48px;
            }
        }
        
        @media screen and (max-width: 320px) {
            .clock {
                font-size: 36px;
            }
        }
        
        /* 로딩 상태 */
        .loading {
            opacity: 0.5;
        }
        
        /* 에러 상태 */
        .error {
            color: #ff0000;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <div class="clock-container">
        <div id="clock" class="clock loading">
            --:--:--
        </div>
    </div>

    <script>
        // iPhone 4 Safari 호환성을 위한 간단한 JavaScript
        var clockElement = document.getElementById('clock');
        var lastUpdateTime = 0;
        var updateInterval = 1000; // 1초마다 업데이트
        
        // 시간 포맷팅 함수
        function formatTime(hours, minutes, seconds) {
            var h = hours.toString();
            var m = minutes.toString();
            var s = seconds.toString();
            
            if (h.length < 2) h = '0' + h;
            if (m.length < 2) m = '0' + m;
            if (s.length < 2) s = '0' + s;
            
            return h + '<span class="time-separator">:</span>' + 
                   m + '<span class="time-separator">:</span>' + s;
        }
        
        // 서버에서 시간 가져오기
        function fetchTime() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/api/time', true);
            xhr.timeout = 5000; // 5초 타임아웃
            
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        try {
                            var timeData = JSON.parse(xhr.responseText);
                            updateClock(timeData);
                        } catch (e) {
                            console.log('JSON 파싱 에러:', e);
                            useLocalTime();
                        }
                    } else {
                        console.log('서버 응답 에러:', xhr.status);
                        useLocalTime();
                    }
                }
            };
            
            xhr.onerror = function() {
                console.log('네트워크 에러');
                useLocalTime();
            };
            
            xhr.ontimeout = function() {
                console.log('요청 타임아웃');
                useLocalTime();
            };
            
            xhr.send();
        }
        
        // 로컬 시간 사용 (폴백)
        function useLocalTime() {
            var now = new Date();
            var timeData = {
                hours: now.getHours(),
                minutes: now.getMinutes(),
                seconds: now.getSeconds()
            };
            updateClock(timeData);
        }
        
        // 시계 업데이트
        function updateClock(timeData) {
            clockElement.innerHTML = formatTime(timeData.hours, timeData.minutes, timeData.seconds);
            clockElement.className = 'clock';
            lastUpdateTime = Date.now();
        }
        
        // 주기적 업데이트
        function startClock() {
            // 즉시 한 번 실행
            fetchTime();
            
            // 1초마다 업데이트
            setInterval(function() {
                var now = Date.now();
                if (now - lastUpdateTime >= updateInterval) {
                    fetchTime();
                }
            }, updateInterval);
        }
        
        // 페이지 로드 시 시계 시작
        if (document.addEventListener) {
            document.addEventListener('DOMContentLoaded', startClock);
        } else if (document.attachEvent) {
            document.attachEvent('onreadystatechange', function() {
                if (document.readyState === 'complete') {
                    startClock();
                }
            });
        } else {
            // 구형 브라우저를 위한 폴백
            window.onload = startClock;
        }
        
        // 화면 터치 방지 (iPhone 4에서 스크롤 방지)
        document.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, false);
        
        // 더블탭 줌 방지
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, false);
        
        var lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            var now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
